---
title: "Deploying a Custom Workflow"
description: "Learn how to deploy a custom workflow to Sieve."
---

First, please make sure you have signed up for a Sieve account as per the [quickstart](/guide/quickstart/intro) guide.

## Install the Sieve CLI

```bash
pip install https://mango.sievedata.com/v1/client_package/sievedata-0.0.1.1.2-py3-none-any.whl
```

Then, export your Sieve API key as an environment variable. You can find your API key in the [Sieve dashboard](https://www.sievedata.com/dashboard/settings).

```bash
export SIEVE_API_KEY=YOUR_API_KEY
```

## Create a Workflow

Create a new folder and add the files below.
<CodeGroup>

```python workflow.py
import sieve
from typing import Dict, Tuple
from yolo import Yolo
from splitter import VideoSplitter

@sieve.workflow(name="yolo_object_detection")
def yolo_workflow(video: sieve.Video) -> Dict:
    images = VideoSplitter(video)
    yolo_outputs = Yolo()(images)
    return yolo_outputs
```

```python splitter.py
import sieve

@sieve.function(
  name="video-splitter",
  gpu = False,
  python_packages=[
    "ffmpeg-python==0.2.0"
  ],
  system_packages=["libgl1-mesa-glx", "libglib2.0-0", "ffmpeg"],
  python_version="3.8"
)
def VideoSplitter(video: sieve.Video) -> sieve.Image:
  # use ffmpeg to extract all frames in video as bmp files and return the path to the folder
  import tempfile
  temp_dir = tempfile.mkdtemp()

  import subprocess
  subprocess.call([
    'ffmpeg',
    '-i', video.path,
    f'{temp_dir}/%09d.jpg'
  ])
  import os
  filenames = os.listdir(temp_dir)
  filenames.sort()
  for i, filename in enumerate(filenames):
    print(os.path.join(temp_dir, filename), i)
    yield sieve.Image(path=os.path.join(temp_dir, filename), frame_number=i, fps=video.fps)
```

```java yolo.py
import sieve
from typing import List, Dict

@sieve.Model(
  name="yolo",
  gpu = True,
  python_packages=[
    "torch==1.8.1",
    "pandas==1.5.2",
    "opencv-python-headless==4.5.4.60",
    "ipython==8.4.0",
    "torch==1.8.1",
    "torchvision==0.9.1",
    "psutil==5.8.0",
    "seaborn==0.11.2"
  ],
  system_packages=["libgl1-mesa-glx", "libglib2.0-0", "ffmpeg"],
  python_version="3.8"
)
class Yolo:
  def __setup__(self):
    import torch
    self.yolo_model = torch.hub.load('ultralytics/yolov5', 'yolov5l')

  def __predict__(self, img: sieve.Image) -> List:
    results = self.yolo_model(img.array)
    outputs = []
    for pred in reversed(results.pred):
      for *box, conf, cls in reversed(pred):
        cls_name = results.names[int(cls)]
        box = [float(i) for i in box]
        score = float(conf)
        if score < 0.7:
          continue
        outputs.append({
          "box": box,
          "class_name": cls_name,
          "score": score,
          "frame_number": None if not hasattr(img, "frame_number") else img.frame_number
        })
      return outputs
```
</CodeGroup>

## Deploy the Workflow

You workflow will be deployed. You can monitor the status via your terminal or on the [Sieve dashboard](https://www.sievedata.com/dashboard).

```bash
sieve deploy
```

## Run the Workflow

You can run the workflow on a video file. You can do this via the dashboard, the API, or the CLI. We can use [this](https://storage.googleapis.com/sieve-test-videos-central/01-lebron-dwade.mp4) file to test.

### CLI
```bash
sieve push yolo_object_detection '{"video": {"url": "https://storage.googleapis.com/sieve-test-videos-central/01-lebron-dwade.mp4"}}'
```

### API
```bash
curl --request POST \
    --url https://mango.sievedata.com/v1/push \
    --header "X-API-Key: $SIEVE_API_KEY" \
    --header "Content-Type: application/json" \
    --data '{
      "workflow_name": "yolo_object_detection",
      "inputs": {
        "video": {
          "url": "https://storage.googleapis.com/sieve-test-videos-central/01-lebron-dwade.mp4"
        }
      }
    }'
```

### Dashboard
Navigate to the `yolo_object_detection` worklow on the [dashboard](https://www.sievedata.com/dashboard/workflows/yolo_object_detection), enter the video URL, and click `Send Request`.

## More Examples

You can find more examples in the [Sieve Examples Repo](https://github.com/sieve-community/examples).
